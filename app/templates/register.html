<!-- app/templates/register.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}">
            <div class="flash-content">
              <i class="flash-icon fas {% if category == 'success' %}fa-check-circle{% elif category == 'error' or category == 'danger' %}fa-exclamation-circle{% elif category == 'info' %}fa-info-circle{% elif category == 'warning' %}fa-exclamation-triangle{% else %}fa-bell{% endif %}"></i>
              <span class="flash-text">{{ message }}</span>
              <button class="flash-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="container">
    <div class="tabs-container">
      <div class="tab" data-tab="login" onclick="switchTab('login')">Login</div>
      <div class="tab active" data-tab="register" onclick="switchTab('register')">Register</div>
    </div>

    <div class="form-container">
      <!--Login-->
      <form method="POST" action="{{ url_for('auth.login') }}" id="loginForm" class="active">
        <h2>Login</h2>
        
        <!-- Google OAuth Button -->
        <button type="button" class="google-login-btn" onclick="loginWithGoogle()">
          <i class="fab fa-google"></i> Continue with Google
        </button>
        
        <div class="divider">
          <span>or</span>
        </div>
        
        <label>Email:</label>
        <input type="email" name="email" placeholder="delusion@gunners.com" required><br>
        <label>Password:</label>
        <input type="password" name="password" placeholder="2nd_aG@!n" required><br><br>
        <button type="submit">Login</button>
        <!-- <div class="forgot-password-link" style="text-align:center; margin-top:1em;">
            <a href="{{ url_for('auth.forgot_password') }}">Forgot your password?</a>
        </div> -->
      </form>

      <!--Register-->
      <form method="POST" action="{{ url_for('auth.register') }}" id="registerForm">
        <h2>Sign Up!</h2>
        
        <!-- Google OAuth Button -->
        <button type="button" class="google-login-btn" onclick="signUpWithGoogle()">
          <i class="fab fa-google"></i> Continue with Google
        </button>
        
        <div class="divider">
          <span>or</span>
        </div>

        <div class="name-container">
          <div><label>First Name:</label>
          <input type="text" name="First Name" required title="Enter your first name" placeholder="Trump"><br><br></div>

          <div>
            <label>Last Name:</label>
          <input type="text" name="Last Name" required title="Enter your last name" placeholder="Tinubu"><br><br>
          </div>
        </div>

        <label>Username:</label>
        <input type="text" name="username" required title="Enter your username" placeholder="Username"><br><br>

        <label>Email:</label>
        <input type="email" name="email" required title="Enter your email address" placeholder="Email address"><br><br>

        <label>Password:</label>
        <input type="password" name="password" required title="Enter your password" placeholder="Password"><br><br>

        <button type="submit">Register</button>
    </form>
    </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/tabs.js') }}"></script>
    
    <!-- Supabase Client for Google OAuth -->
    <script type="module">
      import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
      
      const supabase = createClient(
        '{{ config.SUPABASE_URL or "https://yzrfoxjwqlthhmwvqguu.supabase.co" }}',
        '{{ config.SUPABASE_ANON_KEY or "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl6cmZveGp3cWx0aGhtd3ZxZ3V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNzM4NTcsImV4cCI6MjA2Nzk0OTg1N30.kX-Ez4vTYL5qKa8F8dylV7YJvCht_66UG7_w1Z6UwfA" }}'
      )
      
      window.loginWithGoogle = async () => {
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: window.location.origin + '/auth/callback'
          }
        })
        if (error) console.error('Login error:', error)
      }
      
      window.signUpWithGoogle = async () => {
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: window.location.origin + '/auth/callback'
          }
        })
        if (error) console.error('Signup error:', error)
      }
    </script>
    
    <style>
    .google-login-btn {
      width: 100%;
      padding: 12px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: background-color 0.3s;
    }
    
    .google-login-btn:hover {
      background: #3367d6;
    }
    
    .divider {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }
    
    .divider:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: #ddd;
    }
    
    .divider span {
      background: white;
      padding: 0 15px;
      color: #666;
      font-size: 14px;
    }
    </style>
    
    <!-- Flash Message Auto-Dismiss -->
    <script>
      // Auto-dismiss flash messages after 5 seconds
      document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.querySelectorAll('.flash-message');
        
        flashMessages.forEach(function(message) {
          // Auto-dismiss after 5 seconds
          setTimeout(function() {
            message.classList.add('flash-dismissing');
            setTimeout(function() {
              message.remove();
            }, 300);
          }, 5000);
        });
      });
    </script>
</body>
</html>

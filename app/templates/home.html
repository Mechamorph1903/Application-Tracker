{% extends "layout.html" %}

{% block title %}Dashboard - InternIn{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}
<div class="home-page-container">

    <div class="home-page-header">
        <h1 class="welcome-user">Welcome back, {{ user.firstName }}!</h1>
        <p class="welcome-question">How we feeling today?</p>
    </div>
    <!-- Quick stats section -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.total_applications if stats else 0 }}</div>
                <div class="stat-label">Total Applications</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.interviews if stats else 0 }}</div>
                <div class="stat-label">Interviews</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.offers if stats else 0 }}</div>
                <div class="stat-label">Offers</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.pending if stats else 0 }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>
    </div>

    <!-- Main content grid -->
    <div class="home-page-grid">
        <!-- Recent Applications -->
        <div class="recent-applications-section">
            <div class="grid-section">
                <h3 class="section-title">
                    <i class="fas fa-history"></i>
                    Recent Applications
                </h3>
                {% if recent_applications %}
                <div class="recent-applications">
                    {% for internship in recent_applications %}
                        <div class="application-item" onclick="window.location.href='{{url_for('applications.application_details', internship_id=internship.id)}}'">
                            <div class="application-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="application-content">
                                <div class="application-title">{{ internship.job_name }}</div>
                                <div class="application-company">{{ internship.company_name }}</div>
                                <div class="application-date">{{ internship.applied_date.strftime('%b %d, %Y') if internship.applied_date else 'Date not set' }}</div>
                            </div>
                            <div class="application-status status-{{ internship.application_status.lower().replace(' ', '-') }}">
                                {{ internship.application_status }}
                            </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="section-footer">
                    <a href="{{ url_for('applications.applicationsList') }}" class="view-all-btn">View All Applications â†’</a>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-plus-circle"></i>
                    <p>No applications yet</p>
                    <a href="{{ url_for('applications.add_application') }}" class="add-first-btn">Add Your First Application</a>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="motivation-section">
            <div class="grid-section">
                <h3 class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Daily Motivation
                </h3>
                <div class="motivation-card">
                    <div class="motivation-text">
                        "{{ motivation.message }}"
                    </div>
                    <div class="motivation-footer">
                        {{motivation.author}}<hr>
                        <i>{{motivation.remark}}</i>
                    </div>
                </div>
            </div>
        </div>

        <div class="goals-section">
            <div class="grid-section">
                <h3 class="section-title">
                    <i class="fas fa-bullseye"></i>
                    Goals
                </h3>
                
                <!-- Ongoing Goals -->
                <div class="goals-subsection">
                    <h4 class="subsection-title">
                        <i class="fas fa-play-circle"></i>
                        Ongoing
                    </h4>
                    <ul class="goals-list ongoing-goals">
                        {% set ongoing_goals = goals|selectattr('goal-status', 'equalto', 'active')|list if goals else [] %}
                        {% if ongoing_goals %}
                            {% for goal in ongoing_goals %}
                                <li data-goal-id="{{ goal['goal_id'] }}" class="goal-item ongoing">
                                    <div class="goal-content">
                                        <span class="goal-name">{{ goal['goal-desc'] }}</span>
                                        <span class="goal-date">{{ goal['created_at'][:10] if goal.get('created_at') else 'Unknown' }}</span>
                                    </div>
                                    {% if goal['goal-type'] == 'regular' %}
                                        <div class="goal-actions">
                                            <button class="goal-action cancel-goal-btn" title="Cancel Goal">
                                                <i class="fa-solid fa-xmark"></i>
                                            </button>
                                            <button class="goal-action complete-goal-btn" title="Mark as Done">
                                                <i class="fa-solid fa-check"></i>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div class="goal-actions count-goal">
                                            <progress value="{{ goal.count or 0 }}" max="{{ goal.target }}"></progress>
                                            <span class="progress-text">{{ goal.count or 0 }}/{{ goal.target }}</span>
                                            {% if (goal.count or 0)|int >= goal.target|int %}
                                                <button class="goal-action complete-goal-btn" title="Mark as Complete">
                                                    <i class="fa-solid fa-check"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="no-goals-msg">
                                <i class="fa-solid fa-clock"></i>
                                No ongoing goals. Set one to get started!
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Completed Goals -->
                <div class="goals-subsection">
                    <h4 class="subsection-title">
                        <i class="fas fa-check-circle"></i>
                        Completed
                    </h4>
                    <ul class="goals-list completed-goals">
                        {% set completed_goals = goals|selectattr('goal-status', 'equalto', 'completed')|list if goals else [] %}
                        {% if completed_goals %}
                            {% for goal in completed_goals %}
                                <li data-goal-id="{{ goal['goal_id'] }}" class="goal-item completed">
                                    <div class="goal-content">
                                        <span class="goal-name">{{ goal['goal-desc'] }}</span>
                                        <span class="goal-date">Completed: {{ goal['completed_at'][:10] if goal.get('completed_at') else 'Unknown' }}</span>
                                    </div>
                                    <div class="goal-actions">
                                        <span class="goal-completed-badge">Completed</span>
                                        <button class="remove-goal-btn" title="Remove Goal">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </div>
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="no-goals-msg">
                                <i class="fa-solid fa-smile"></i>
                                No completed goals yet. Keep going!
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <div id="add-goal">
                    <button id="add-goal-btn">
                        <i class="fa-solid fa-plus"></i>
                        New Goal
                    </button>
                </div>
            </div>
        </div>

        <div class="quick-actions-section">
            <div class="grid-section">
                <h3 class="section-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </h3>
                <div class="actions-grid">
                    <a href="{{ url_for('applications.add_application') }}" class="action-btn primary">
                        <i class="fas fa-plus"></i>
                        Add Application
                    </a>
                    <a href="{{ url_for('calendar') }}" class="action-btn">
                        <i class="fas fa-calendar"></i>
                        View Calendar
                    </a>
                    <a href="{{ url_for('applications.applicationsList') }}" class="action-btn">
                        <i class="fas fa-search"></i>
                        Search Applications
                    </a>
                    <a href="{{ url_for('profile.profile') }}" class="action-btn">
                        <i class="fas fa-user"></i>
                        View Profile
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="goals-back">
    <div id="goals-form" >
        <div class="section-1">
            <i class="fa-solid fa-xmark" id="close-goals-form"></i>
        </div>
        <div class="section-2">
            <h2>Select Goal Type</h2>
            <div class="goal-type-container">
                <div class="goal-type" id="regular-goal">
                    <div class="goal-title">
                        <i class="fa-solid fa-list-check"></i>
                        <h3>Regular Goal</h3>
                    </div>
                    <p>
                        Any type of goal you may want to track.
                    </p>
                </div>
                <div class="goal-type" id="app-count-goal">
                    <div class="goal-title">
                        <i class="fa-solid fa-hashtag"></i>
                        <h3>Application Target</h3>
                    </div>
                    <p>
                        Set a number of applications you want to hit!
                    </p>
                </div>
            </div>
              <!-- Regular Goal Form -->
            <form id="regular-goal-form" class="goal-slide-form" method="POST" action="{{ url_for('add_goal') }}">
                <h3>New Regular Goal</h3>
                <input type="text" placeholder="Goal name" name="regular_goal" required>
                <button type="submit">Save</button>
            </form>
            <!-- Application Target Form -->
            <form id="app-count-goal-form" class="goal-slide-form" method="POST" action="{{ url_for('add_goal') }}">
                <h3>Set Application Target</h3>
                <input type="number" placeholder="Number of applications" min="1" name="app_count_goal" required>
                <button type="submit">Save</button>
            </form>
        </div>
    </div>
</div>

{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='js/home.js')}}"></script>
{%endblock%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Profile - InternIn{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="profile-container">
        <!-- Cover Image Section -->
        <div class="cover-section">
            <div class="cover-overlay"></div>
            <div class="back-button">
                <a href="javascript:void(0)" onclick="goBackToLastPage()" title="Go back to previous page">
			        <i class="fas fa-arrow-left"></i>
		        </a> 
            </div>
            <div class="settings">
                <a href="{{ url_for('settings.settings_page') }}" class="settings-link" onclick="storeCurrentPage(event)">
                    <img src="{{ url_for('static', filename='images/settings.png') }}" alt="Settings Icon" class="settings-icon">
                     <i class="settings-text">Settings</i>
                </a>
               
            </div>
        </div>

        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-info">
                <div class="profile-picture">
                    {% if user.profile_picture and user.profile_picture != 'default.jpg' %}
                        <img src="{{ url_for('static', filename='uploads/profile_pictures/' + user.profile_picture) }}" alt="Profile Picture" class="profile-img">
                    {% else %}
                        <div class="profile-initials">{{ user | initials }}</div>
                    {% endif %}
                </div>
                <div class="profile-details">
                    <h1 class="profile-name">{{ user.firstName }} {{ user.lastName }}</h1>
                    <div class="online-status">
                        <div class="status-indicator"></div>
                        <span>Online now</span>
                    </div>
                    <div class="school-info">
                        <div id="school">School: {{ user.school }}</div>
                        <div id="year">Class: {{ user.year }}</div>
                        <div id="major">Major: {{ user.major }}</div>
                    </div>
                    <div class="social-links">
                        {%if user.social_media %}
                            {% for social_link in user.social_media %}
                                <a href="{{ social_link.url }}" class="social-link" target="_blank" rel="noopener noreferrer">
                                    <i class="{{ social_link.platform|social_icon }}"></i>
                                     <span>{{ social_link.platform }}</span>
                                </a>
                            {% endfor %}
                        {% else %}
                            <p>No Social Media Added</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="left-column">
                <!-- Activity Section -->
                <div class="section">
                    <h2 class="section-title">
                        Recent Applications
                    </h2>
                    
                    <div class="activity-item">
                        <div class="activity-icon">
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Software Engineer Intern - Google</div>
                            <div class="activity-details">Applied 2 days ago • Mountain View, CA</div>
                        </div>
                        <div class="activity-status status-pending">Pending</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Frontend Developer - Meta</div>
                            <div class="activity-details">Applied 1 week ago • Menlo Park, CA</div>
                        </div>
                        <div class="activity-status status-approved">Interview Scheduled</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Full Stack Developer - Stripe</div>
                            <div class="activity-details">Applied 2 weeks ago • San Francisco, CA</div>
                        </div>
                        <div class="activity-status status-rejected">Not Selected</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">iOS Developer - Apple</div>
                            <div class="activity-details">Applied 3 weeks ago • Cupertino, CA</div>
                        </div>
                        <div class="activity-status status-pending">Under Review</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Data Engineer - Netflix</div>
                            <div class="activity-details">Applied 1 month ago • Los Gatos, CA</div>
                        </div>
                        <div class="activity-status status-approved">Offer Received</div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <!-- Stats Section -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Application Stats
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">24</div>
                            <div class="stat-label">Total Applications</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Interviews</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Offers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">67%</div>
                            <div class="stat-label">Response Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Heatmap -->
                <div class="section">
                    <h2 class="section-title">
                        Activity Calendar
                    </h2>
                    <div class="heatmap-container">
                        <div class="heatmap-header">
                            <span>Application activity over the past year</span>
                        </div>
                        <div class="heatmap-grid">
                        </div>
                        <div class="heatmap-legend">
                            <span>Less</span>
                            <div class="legend-item">
                                <div class="heatmap-cell"></div>
                            </div>
                            <div class="legend-item">
                                <div class="heatmap-cell level-1"></div>
                            </div>
                            <div class="legend-item">
                                <div class="heatmap-cell level-2"></div>
                            </div>
                            <div class="legend-item">
                                <div class="heatmap-cell level-3"></div>
                            </div>
                            <div class="legend-item">
                                <div class="heatmap-cell level-4"></div>
                            </div>
                            <span>More</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Navigation state management using stack
        function goBackToLastPage() {
            const lastPage = popFromNavigationStack();
            
            if (lastPage && lastPage !== window.location.href) {
                window.location.href = lastPage;
            } else {
                window.location.href = '/home';
            }
        }
        
        // Store navigation when arriving at profile
        document.addEventListener('DOMContentLoaded', function() {
            // Push current page to navigation stack if coming from valid pages
            if (document.referrer) {
                const referrerPath = new URL(document.referrer).pathname;
                if (['/home', '/friends', '/applications/applications-list', '/calendar'].includes(referrerPath)) {
                    pushToNavigationStack(document.referrer);
                }
            }
        });
        
        // Navigation stack functions (defined in layout.html)
        function pushToNavigationStack(page) {
            const stack = JSON.parse(sessionStorage.getItem('navigationStack') || '[]');
            if (stack.length === 0 || stack[stack.length - 1] !== page) {
                stack.push(page);
                if (stack.length > 5) {
                    stack.shift();
                }
                sessionStorage.setItem('navigationStack', JSON.stringify(stack));
            }
        }
        
        function popFromNavigationStack() {
            const stack = JSON.parse(sessionStorage.getItem('navigationStack') || '[]');
            if (stack.length > 0) {
                stack.pop();
                sessionStorage.setItem('navigationStack', JSON.stringify(stack));
                return stack[stack.length - 1];
            }
            return null;
        }
        
        // Store current page when navigating TO settings
        function storeCurrentPage(event) {
            pushToNavigationStack(window.location.href);
        }
    </script>
</body>
</html>